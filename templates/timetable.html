<!DOCTYPE html>
<html lang="en">
<head>
    <title>Your Timetable</title>
</head>
<body>
    <h2>Timetable View</h2>

    {% if permission_level == 'staff' %}
        <div class="student-selector">
            <h3>View Student Timetable</h3>
            <form method="get">
                <select name="student_id" onchange="this.form.submit()">
                    <option value="">Select a student...</option>
                    {% for student in students %}
                        <option value="{{ student.id }}" {% if current_user.id == student.id %}selected{% endif %}>
                            {{ student.username }} ({{ student.year_group }})
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>
    {% endif %}

    <!-- Week Navigation -->
    <h3>Week: {{ week_range }}</h3>
    <form method="post">
        <button type="submit" name="week_change" value="-1">Previous Week</button>
        <button type="submit" name="week_change" value="1">Next Week</button>
    </form>

    <!-- Display Current Week's Timetable -->
    <h3>Timetable for {{ current_user.username }}</h3>
    {% if timetable %}
        <table border="1">
            <tr>
                {% for day in ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] %}
                    <th>{{ day }} - {{ (week_start + timedelta(days=loop.index0)).strftime('%d/%m') }}</th>
                {% endfor %}
            </tr>
            <tr>
                {% for day in ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] %}
                    <td>
                        <ul>
                            {% for entry in timetable if entry.date.strftime('%A') == day %}
                                <li>
                                    {{ entry.start_time.strftime('%H:%M') }} - {{ entry.end_time.strftime('%H:%M') }}<br>
                                    <strong>{{ entry.subject }}</strong><br>
                                    {{ entry.teacher }}{% if entry.is_substitute %} (Substitute){% endif %}<br>
                                    Room: {{ entry.room if entry.room else "Not assigned" }}<br>
                                    <hr>
                                </li>
                            {% endfor %}
                        </ul>
                    </td>
                {% endfor %}
            </tr>
        </table>
    {% else %}
        <p>No timetable entries for this week.</p>
    {% endif %}

    <p><a href="{{ url_for('dashboard') }}">Back to Dashboard</a></p>
</body>
</html>
